#############################################################################
# CPLS Backend - Production Environment Variables
#############################################################################
# Copy this file to .env.production and fill in your actual values
# DO NOT commit .env.production to git (it's in .gitignore)
#
# Usage:
#   1. Copy: cp .env.production.example .env.production
#   2. Fill in your values below
#   3. Use with deploy script or set manually in Cloud Run
#############################################################################

#############################################################################
# Database Configuration (Supabase or Cloud SQL)
#############################################################################

# Supabase Example:
# Get from: Supabase Dashboard → Settings → Database → Connection string
DB_HOST=db.xxxxxxxxxxxxx.supabase.co
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your-supabase-password-here
DB_NAME=postgres

# Cloud SQL Example (uncomment if using Cloud SQL):
# DB_HOST=/cloudsql/your-project:asia-southeast1:cpls-db
# DB_PORT=5432
# DB_USER=postgres
# DB_PASSWORD=your-cloud-sql-password
# DB_NAME=cpls_db

#############################################################################
# Application Configuration
#############################################################################

# Port (Cloud Run will override this automatically)
PORT=8080

# Environment (development, staging, production)
ENVIRONMENT=production

#############################################################################
# Security
#############################################################################

# JWT Secret (IMPORTANT: Generate a strong random key!)
# Generate with: openssl rand -base64 32
# Example: aB3dE5fG7hI9jK1lM3nO5pQ7rS9tU1vW3xY5zA==
JWT_SECRET=your-random-jwt-secret-at-least-32-characters

#############################################################################
# Trading Configuration (Optional - có defaults trong code)
#############################################################################

# Commission rate (0.15% default for Vietnam)
DEFAULT_COMMISSION_RATE=0.0015

# Tax rate (0.1% default for Vietnam)
DEFAULT_TAX_RATE=0.001

#############################################################################
# Redis Configuration (Optional - for caching)
#############################################################################

# Uncomment if using Redis
# REDIS_HOST=your-redis-host.com
# REDIS_PORT=6379
# REDIS_PASSWORD=your-redis-password

#############################################################################
# External API Keys (Optional - for real stock data)
#############################################################################

# SSI API (https://iboard.ssi.com.vn/)
# SSI_API_KEY=your-ssi-api-key
# SSI_API_SECRET=your-ssi-api-secret

# VNDirect API (https://www.vndirect.com.vn/)
# VNDIRECT_API_KEY=your-vndirect-api-key

# TCBS API (https://www.tcbs.com.vn/)
# TCBS_API_KEY=your-tcbs-api-key

#############################################################################
# Monitoring & Logging (Optional)
#############################################################################

# Log level (debug, info, warn, error)
# LOG_LEVEL=info

# Sentry DSN (for error tracking)
# SENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx

#############################################################################
# Feature Flags (Optional)
#############################################################################

# Enable/disable features
# ENABLE_TRADING_BOT=true
# ENABLE_BACKTESTING=true
# ENABLE_AUTO_UPDATE=true

#############################################################################
# INSTRUCTIONS FOR DEPLOYMENT
#############################################################################

# Method 1: Set via gcloud CLI
# ──────────────────────────────────────────────────────────────────────
# source .env.production
#
# gcloud run services update cpls-backend \
#   --region=asia-southeast1 \
#   --set-env-vars="DB_HOST=${DB_HOST}" \
#   --set-env-vars="DB_PORT=${DB_PORT}" \
#   --set-env-vars="DB_USER=${DB_USER}" \
#   --set-env-vars="DB_PASSWORD=${DB_PASSWORD}" \
#   --set-env-vars="DB_NAME=${DB_NAME}" \
#   --set-env-vars="JWT_SECRET=${JWT_SECRET}" \
#   --set-env-vars="ENVIRONMENT=production"

# Method 2: Set via Cloud Console
# ──────────────────────────────────────────────────────────────────────
# 1. Go to: https://console.cloud.google.com/run
# 2. Select service: cpls-backend
# 3. Click: EDIT & DEPLOY NEW REVISION
# 4. Tab: VARIABLES & SECRETS
# 5. Add each variable manually

# Method 3: Use Cloud Build substitutions (via cloudbuild.yaml)
# ──────────────────────────────────────────────────────────────────────
# Set substitution variables in Cloud Build trigger:
#   1. Go to: https://console.cloud.google.com/cloud-build/triggers
#   2. Edit your trigger for cpls-be
#   3. In "Substitution variables" section, add:
#      - _DB_HOST: db.xxxxxxxxxxxxx.supabase.co
#      - _DB_PASSWORD: your-supabase-password
#      - _JWT_SECRET: your-jwt-secret
#   4. Run the trigger to deploy

# Method 4: Use Secret Manager (Recommended for production)
# ──────────────────────────────────────────────────────────────────────
# See: DEPLOYMENT_GUIDE_STEP_BY_STEP.md section 8.4

#############################################################################
# SECURITY NOTES
#############################################################################

# ⚠️  NEVER commit .env.production to git
# ⚠️  Use strong passwords (16+ characters, mixed case, numbers, symbols)
# ⚠️  Rotate JWT_SECRET periodically
# ⚠️  Use Secret Manager for production
# ⚠️  Enable SSL/TLS for database connections (Supabase has this by default)
# ⚠️  Set up IP whitelisting if possible
# ⚠️  Monitor access logs regularly

#############################################################################
# VALIDATION CHECKLIST
#############################################################################

# Before deploying, verify:
# ☐ DB_HOST is correct (test connection)
# ☐ DB_PASSWORD is strong and correct
# ☐ JWT_SECRET is at least 32 characters
# ☐ JWT_SECRET is random (not a dictionary word)
# ☐ ENVIRONMENT is set to "production"
# ☐ All required variables are filled
# ☐ No placeholder values (e.g., "your-password-here")
# ☐ File is NOT committed to git (check .gitignore)

#############################################################################
# SUPABASE AUTH CONFIGURATION (Optional but recommended)
#############################################################################

# Supabase Project URL (from: Project Settings → API)
SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co

# Supabase Anon Key (from: Project Settings → API → anon/public)
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Supabase Service Role Key (from: Project Settings → API → service_role)
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Supabase JWT Secret (from: Project Settings → API → JWT Secret)
SUPABASE_JWT_SECRET=your-supabase-jwt-secret

#############################################################################
# ADMIN CREDENTIALS (for seeding default admin user)
#############################################################################

# Default admin username
ADMIN_DEFAULT_USERNAME=admin

# Default admin password (CHANGE THIS IN PRODUCTION!)
ADMIN_DEFAULT_PASSWORD=your-secure-admin-password

#############################################################################
# GOOGLE SECRET MANAGER SETUP
#############################################################################
# Run these commands to create secrets in Google Secret Manager:
#
# gcloud secrets create cpls-db-host --data-file=-
# gcloud secrets create cpls-db-port --data-file=-
# gcloud secrets create cpls-db-user --data-file=-
# gcloud secrets create cpls-db-password --data-file=-
# gcloud secrets create cpls-db-name --data-file=-
# gcloud secrets create cpls-jwt-secret --data-file=-
# gcloud secrets create cpls-supabase-url --data-file=-
# gcloud secrets create cpls-supabase-anon-key --data-file=-
# gcloud secrets create cpls-supabase-service-key --data-file=-
# gcloud secrets create cpls-supabase-jwt-secret --data-file=-
# gcloud secrets create cpls-admin-username --data-file=-
# gcloud secrets create cpls-admin-password --data-file=-
#
# Grant Cloud Run access:
# PROJECT_ID=$(gcloud config get-value project)
# PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format='value(projectNumber)')
# gcloud secrets add-iam-policy-binding cpls-db-password \
#   --member="serviceAccount:$PROJECT_NUMBER-compute@developer.gserviceaccount.com" \
#   --role="roles/secretmanager.secretAccessor"

#############################################################################
# HELP & DOCUMENTATION
#############################################################################

# Quick Start: QUICK_START_DEPLOY.md
# Full Guide: DEPLOYMENT_GUIDE_STEP_BY_STEP.md
# Troubleshooting: DEPLOYMENT_GUIDE_STEP_BY_STEP.md section 10
# All Docs: DEPLOYMENT_DOCS.md
